# Домашнее задание к занятию «Репликация и масштабирование. Часть 2»


### Задание 1

Опишите основные преимущества использования масштабирования методами:

- активный master-сервер и пассивный репликационный slave-сервер; 
- master-сервер и несколько slave-серверов;
- активный сервер со специальным механизмом репликации — distributed replicated block device (DRBD);
- SAN-кластер.

*Дайте ответ в свободной форме.*

### Решение 1

1. Активный master-сервер и пассивный репликационный slave-сервер:
- Отказоустойчивость: В случае отказа основного (master) сервера, пассивный (slave) сервер может быстро взять на себя его функции, минимизируя простои и потерю данных.
- Распределение нагрузки: Пассивный сервер может использоваться для резервного копирования или для обработки части нагрузки, снижая нагрузку на основной сервер.

2. Master-сервер и несколько slave-серверов:
- Горизонтальное масштабирование: Добавление дополнительных slave-серверов позволяет равномерно распределить нагрузку и обеспечить более эффективное использование ресурсов.
- Высокая доступность: Если один из slave-серверов выходит из строя, другие серверы могут продолжать работу без простоев.

3. Активный сервер со специальным механизмом репликации — distributed replicated block device (DRBD):
- Синхронная репликация данных: DRBD обеспечивает синхронную репликацию данных между узлами, что гарантирует целостность данных и минимизирует потери при сбоях.
- Прозрачность: Для приложений и конечных пользователей DRBD выглядит как обычное блочное устройство, что обеспечивает прозрачное взаимодействие.

4. SAN-кластер:
- Высокая производительность: SAN-кластер обеспечивает доступ к общим ресурсам хранения данных, что позволяет повысить производительность и масштабируемость.
- Управление централизованно: Централизованное управление ресурсами и конфигурацией облегчает администрирование и обеспечивает высокую доступность.

---

### Задание 2


Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц: 

- пользователи, 
- книги, 
- магазины (столбцы произвольно). 

Опишите принципы построения системы и их разграничение или разбивку между базами данных.

*Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.* 

### Решение 2
[plan vert](https://github.com/sash3939/Replication_and_Scaling/assets/156709540/a6783222-30d0-4d7c-a892-506ff3e1983b)
[plan horiz](https://github.com/sash3939/Replication_and_Scaling/assets/156709540/482b7ba6-d2aa-4c8b-9277-3d325a819e0d)

**План выполнения**:
1. Горизонтальное шардирование:
**Пользователи**: Можно шардировать пользователей на основе географических данных. Например, можно разделить пользователей по странам или регионам: шард 1 для пользователей из России, шард 2 для пользователей из других стран и т.д.
**Книги**: Книги можно шардировать на основе авторов или годов выпуска. Например, можно создать шарды для различных авторов: шард 1 для классической литературы, шард 2 для научной фантастики и т.д.
**Магазины**: Магазины можно шардировать на основе их расположения или территориального покрытия. Например, можно создать шарды для магазинов в разных городах или регионах: шард 1 для магазинов в Москве, шард 2 для магазинов в Санкт-Петербурге и т.д.


2. Вертикальное шардирование:

**Пользователи**: Можно вертикально шардировать таблицу пользователей на основе их характеристик. Например, можно создать отдельные шарды для базовой информации о пользователе (ID, имя, фамилия) и дополнительных атрибутов (адрес, контактная информация).
**Книги**: Книги можно вертикально шардировать на основе их характеристик, содержание и отзывы пользователей. Например, можно создать шарды для основной информации о книге (ID, название, автор) и дополнительных данных (год выпуска, рейтинг).
**Магазины**: Магазины можно вертикально шардировать на основе их характеристик или операционной информации. Можно создать шарды для основной информации о магазине (ID, название, адрес) и дополнительных данных (город, дата продажи).


**Режимы работы серверов**:

**Режим чтения (Read-Only)**:
- В этом режиме серверы обрабатывают только запросы на чтение данных.
- Разрешается только операции SELECT.

**Режим записи (Write-Only)**:
- В этом режиме серверы обрабатывают только запросы на запись данных.
- Разрешены операции INSERT, UPDATE, DELETE. Этот режим может быть активирован для серверов, которые не предоставляют данные для чтения, а только принимают обновления.

**Режим чтения и записи (Read-Write)**:
- В этом режиме серверы обрабатывают как запросы на чтение, так и запросы на запись данных.
- Разрешаются все операции (SELECT, INSERT, UPDATE, DELETE).


**Принципы построения системы горизонтального и вертикального шардинга баз данных:**

**Идентификация ключа шардинга**:
Основным является выбор ключа шардинга, который определяет, как данные будут разделены между шардами. Этот ключ может быть выбран на основе типа данных (например, идентификатор пользователя, книги или магазина), а также на основе типов запросов и их частоты.
**Разделение данных**:
После выбора ключа шардинга данные должны быть разделены на группы в соответствии с этим ключом. Например, данные о пользователях, книгах и магазинах могут быть разделены на группы на основе географического расположения, типов книг и др.
**Создание отдельных баз данных для каждого шарда**:
Каждая группа данных, или шард, должна иметь свою собственную базу данных для хранения. Это позволяет изолировать данные и обеспечивает более эффективное управление ими. Может быть создана отдельная база данных для пользователей, книг и магазинов каждого шарда.
**Управление доступом и безопасностью:**
Важно обеспечить управление доступом и безопасностью для каждой базы данных и шарда. Это может включать в себя установку соответствующих прав доступа для пользователей и ролей, а также механизмы шифрования и аутентификации.
**Обеспечение согласованности данных**:
Для обеспечения согласованности данных между шардами необходимы механизмы репликации и синхронизации данных.
**Распределение запросов**:
Для эффективной работы системы необходимо распределять запросы между различными шардами. Это может включать в себя использование механизмов маршрутизации запросов на основе ключа шардинга или режима доступа к данным (чтение или запись).
**Мониторинг и управление производительностью**:
Важно постоянно отслеживать производительность и доступность каждого шарда базы данных и предпринимать меры для оптимизации их работы. Это может включать в себя мониторинг нагрузки на шарды.
**Гибкость и масштабируемость**:
Система должна быть гибкой и масштабируемой, чтобы легко адаптироваться к изменяющимся требованиям и увеличивать емкость при необходимости.

## Дополнительные задания (со звёздочкой*)
Эти задания дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

---
### Задание 3*

Выполните настройку выбранных методов шардинга из задания 2.

*Пришлите конфиг Docker и SQL скрипт с командами для базы данных*.
